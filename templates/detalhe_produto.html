{% extends "base.html" %}
{% block title %}Detalhes de {{ produto.nome }}{% endblock %}

{% block content %}
    
    <a href="{{ url_for('index') }}" class="btn btn-outline-secondary mb-3">
        <i class="fas fa-arrow-left me-2"></i> Voltar ao Catálogo
    </a>

    <div class="row g-4 g-lg-5">
        
        <div class="col-lg-5">
            <img src="{{ produto.imagem_url }}" alt="{{ produto.nome }}" class="img-fluid rounded shadow-sm w-100">
            
            <div class="d-flex mt-3">
                <img src="{{ produto.imagem_url }}" alt="Mini 1" class="img-thumbnail me-2" style="width: 70px; height: 50px; object-fit: cover; opacity: 0.5;">
                <img src="https://via.placeholder.com/100x70.png" alt="Mini 2" class="img-thumbnail me-2" style="width: 70px; height: 50px; object-fit: cover;">
                <img src="https://via.placeholder.com/100x70.png" alt="Mini 3" class="img-thumbnail me-2" style="width: 70px; height: 50px; object-fit: cover;">
            </div>

            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">Características (POO)</h5>
                </div>
                <div class="card-body">
                    <p class="mb-1"><strong>Herança:</strong> <span class="badge" style="background-color: var(--cor-primaria);">{{ produto.categoria }}</span></p>
                    <p class="mb-1"><strong>Peso p/ Frete:</strong> {{ "%.1f"|format(produto.peso) }} kg</p>
                    <p class="mb-0"><strong>Cód. Modelo:</strong> {{ pid }}</p>
                </div>
            </div>
        </div>

        <div class="col-lg-7">
            
            <h1>{{ produto.nome }}</h1>
            
            <div class="mb-3">
                <span class="text-warning">
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star"></i>
                    <i class="fas fa-star-half-alt"></i>
                </span>
                <span class="text-muted">(5.0) | {{ avaliacoes | length }} avaliações</span>
            </div>

            <div class="bg-light p-3 rounded mb-3">
                <p class="text-muted text-decoration-line-through mb-1">R$ {{ "%.2f"|format(produto.preco * 1.32) }} (32% OFF)</p>
                <h2 class="fw-bold mb-1" style="color: var(--cor-primaria);">R$ {{ "%.2f"|format(produto.preco) }}</h2>
                <p class="text-success fw-bold mb-0">10x de R$ {{ "%.2f"|format(produto.preco / 10) }} sem juros</p>
            </div>

            <form method="POST" action="{{ url_for('adicionar_item_processa') }}" class="mt-4">
                
                <input type="hidden" name="produto_id" value="{{ pid }}"> 
                
                <div class="input-group input-group-lg mb-3" style="max-width: 200px;">
                    <span class="input-group-text">Qtde:</span>
                    <input type="number" id="quantidade_input" name="quantidade" value="1" min="1" class="form-control text-center">
                </div>
                
                <div class="d-grid gap-2 d-md-flex">
                    <button type="submit" name="acao_compra" value="compra_imediata" class="btn btn-success btn-lg flex-grow-1 fw-bold">
                        <i class="fas fa-bolt me-2"></i> COMPRAR AGORA
                    </button> 
                    <button type="submit" name="acao_compra" value="adicionar_carrinho" class="btn btn-search-custom btn-lg flex-grow-1 fw-bold">
                        <i class="fas fa-cart-plus me-2"></i> ADICIONAR AO CARRINHO
                    </button>
                </div>
            </form>
            
            <hr class="my-4">

            <div class="shipping-info">
                <h5><i class="fas fa-truck me-2"></i>Calcule o frete e prazo</h5>
                <div class="border rounded p-3 bg-light">
                    <p class="fw-bold mb-1">Valor do Frete (Lógica Polimórfica):</p>
                    <p class="h4 text-dark mb-0">R$ {{ "%.2f"|format(frete) }}</p>
                </div>
            </div>
        </div>
    </div>

    <hr class="my-5">
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <h2><i class="fas fa-comments me-2"></i> Opiniões de Quem Comprou</h2>
            
            <div class="card shadow-sm my-4">
                <div class="card-body">
                    <h5 class="card-title">Deixe sua avaliação (Associação)</h5>
                    <form action="#" method="POST" class="review-form">
                        <div class="mb-3">
                            <label for="nota" class="form-label">Nota (1 a 5):</label>
                            <input type="number" name="nota" min="1" max="5" required class="form-control" style="width: 100px;">
                        </div>
                        <div class="mb-3">
                            <label for="comentario" class="form-label">Comentário:</label>
                            <textarea name="comentario" rows="3" class="form-control"></textarea>
                        </div>
                        <button type="submit" class="btn btn-dark">Enviar Avaliação</button>
                    </form>
                </div>
            </div>

            <div class="list-group">
                {% for review in avaliacoes %}
                    <div class="list-group-item list-group-item-action flex-column align-items-start">
                        <div class="d-flex w-100 justify-content-between">
                            <h5 class="mb-1">{{ review.nome }}</h5>
                            <small class="text-warning">
                                {% for i in range(review.nota) %}<i class="fas fa-star"></i>{% endfor %}
                            </small>
                        </div>
                        <p class="mb-1 fst-italic">"{{ review.comentario }}"</p>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>

    {% endblock %}
