{% extends "base.html" %}
{% block title %}Dashboard Principal | TechNova Store{% endblock %}

{% block content %}

    {% if erro_carrinho %}
        <input type="hidden" id="aviso-carrinho-hidden" value="{{ aviso_carrinho }}">
    {% endif %}

    <div class="promo-section">
        <h2 style="color: #E60014; border-bottom-color: #E60014;">üî• PROMO√á√ïES IMPERD√çVEIS</h2>
        
        <div class="promo-grid">
            {% for pid, produto in produtos %}
                {% if loop.index <= 5 %} 
                    <a href="{{ url_for('detalhe_produto', pid=pid) }}" style="text-decoration: none; color: inherit;">
                        {% include 'product_card.html' %} 
                    </a>
                {% endif %}
            {% endfor %}
        </div>
    </div>
    
    <hr style="margin: 40px 0;">

    <h2 style="color: var(--primary-color);">Todos os Produtos (Geral)</h2>
    
    <div class="product-grid-5"> 
        {% for pid, produto in produtos %}
            <a href="{{ url_for('detalhe_produto', pid=pid) }}" style="text-decoration: none; color: inherit;">
                {% include 'product_card.html' %} 
            </a>
        {% endfor %}
    </div>

    <hr style="margin-top: 40px;">

    {% if session.get('is_admin') %} 
    
        <h2 style="color: #dc3545;">
            ‚úÖ PAINEL ADMINISTRATIVO ATIVO 
            <a href="{{ url_for('admin_dashboard') }}" class="btn" style="background-color: #dc3545; color: white; padding: 5px 10px; font-size: 0.8em;">Gerenciar Produtos (CRUD)</a>
        </h2>
        <p style="font-style: italic;">Estes dados s√£o vis√≠veis apenas para voc√™, Admin.</p>
        
        <h3 style="font-weight: 500;">Clientes Cadastrados</h3>
        <table style="margin-bottom: 25px;">
            <thead>
                <tr>
                    <th>Cliente ID</th>
                    <th>Nome (Heran√ßa)</th>
                    <th>CPF</th>
                </tr>
            </thead>
            <tbody>
                {% for cid, cliente in clientes %}
                <tr>
                    <td>{{ cid }}</td>
                    <td>{{ cliente.nome }}</td>
                    <td>{{ cliente.cpf }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        <h3 style="font-weight: 500;">Carrinhos/Pedidos em Aberto</h3>
        <table>
            <thead>
                <tr>
                    <th>Carrinho ID</th>
                    <th>Status</th>
                    <th>Cliente Associado</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody>
                {% for cid, carrinho in carrinhos %}
                <tr>
                    <td>{{ cid }}</td>
                    <td>{{ carrinho.status }}</td>
                    <td>{{ carrinho.cliente.nome }}</td>
                    <td>R$ {{ "%.2f"|format(carrinho.calcular_total()) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        
    {% else %}
        <h2 style="color: #666;">Funcionalidades POO</h2>
        <p>Acesse o login (üë§) para iniciar sua jornada de compra ou ver o Painel Administrativo.</p>
        
    {% endif %}

{% endblock %}